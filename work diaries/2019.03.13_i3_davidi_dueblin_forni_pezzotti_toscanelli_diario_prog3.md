# GESTIONE CASINÒ | Diario di lavoro - 13.03.2019
##### Matan Davidi, Thor Düblin, Matteo Forni, Carlo Pezzotti, Mattia Toscanelli
### Trevano, 13 marzo 2019

## Lavori svolti
Durante la giornata di oggi, Matan ha dovuto aggiungere una colonna alla tabella user del database dove deve venir inserita la data e l'ora della registrazione di un utente in modo da poter usare questo dato per cancellare eventuali utenti non confermati dopo un giorno dalla loro registrazione. Un evento pianificato per essere avviato ogni 12 ore si occupa di cancellare questi utenti. Inoltre ha dovuto creare un trigger che si accertasse che la data di registrazione non fosse nulla, in caso contrario deve essere inserita la data e l'ora dell'inserimento.

Questo può essere fatto con il seguente codice:
```SQL
ALTER TABLE cashyland.user ADD COLUMN registration_date DATETIME;

USE cashyland;

DELIMITER //

CREATE EVENT IF NOT EXISTS delete_unverified_users
ON SCHEDULE EVERY 12 HOUR
DO
BEGIN
	DELETE FROM cashyland.user WHERE verified = 0 AND registration_date <= subdate(NOW(), 1);
END
//
```

Invece il trigger viene creato con il codice seguente:

```SQL
USE cashyland;

DELIMITER //

CREATE TRIGGER before_user_insert BEFORE INSERT ON user
FOR EACH ROW
BEGIN
	IF NEW.registration_date IS NULL THEN
		SET NEW.registration_date = NOW();
    END IF;
END
//

```

Oggi Matteo ha provato a rendere funzionante il collegamento fra github e Jenkins facendo si che quest'ultimo eseguisse i push delle nostre modifiche del codice sulla repository di produzione. Questo ha però creato ancora problemi.

##  Problemi riscontrati e soluzioni adottate

Matteo ha riscontrato, come la settimana scorsa, dei problemi con le credenziali e con le versioni di Github ed ha provato a risolverli aggiungendo una chiave ssh all'utente GitHub.
![Chiave ssh Jenkins user](../media/SSHKeyJenkinsUser.png)
Questa operazione non è però risultata efficacie e dunque ha provato cambiando lo script aggiungendo un pull prima delle altre operazioni di git così da lavorare sempre sulla versione aggiornata anche se teoricamente l'utente di Jenkins sarà l'unico che utilizzerà quella repo. Questa soluzione ha solamente modificato l'errore ottenuto nel seguente.
![Error Push Jenkins](../media/GitPush&PullError.png)

##  Punto della situazione rispetto alla pianificazione
Rispetto alla pianificazione siamo in orario.

## Programma di massima per la prossima giornata di lavoro
Matteo la prossima settimana proverà a chiedere aiuto per risolvere i suoi problemi che calcolava di risolvere entro oggi.
